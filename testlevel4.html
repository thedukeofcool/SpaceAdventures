<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <title>Test Alpha Version 4.0.3</title>
    <script src="phaser.js"></script>
    <script>src="ScrollMaker.js"</script>

  </head>
  <body style="background-color:#4800FF;">
    <script>
  var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);

function preload ()
{

    this.load.on('progress', function (value) {
        console.log(value);
    });

    this.load.on('fileprogress', function (file) {
        console.log(file.src);
    });

    this.load.on('complete', function () {
        console.log('complete');
    });

    var progressBar = this.add.graphics();
    var progressBox = this.add.graphics();
    progressBox.fillStyle(0x222222, 0.8);
    progressBox.fillRect(240, 270, 320, 50);

    this.load.on('progress', function (value) {
    console.log(value);
    progressBar.clear();
    progressBar.fillStyle(0xffffff, 1);
    progressBar.fillRect(250, 280, 300 * value, 30);
    });

    var width = this.cameras.main.width;
    var height = this.cameras.main.height;
    var loadingText = this.make.text({
    x: width / 2,
    y: height / 2 - 50,
    text: 'Loading...',
    style: {
        font: '20px monospace',
        fill: '#ffffff'
    }
});
loadingText.setOrigin(0.5, 0.5);

var percentText = this.make.text({
    x: width / 2,
    y: height / 2 - 5,
    text: '0%',
    style: {
        font: '18px monospace',
        fill: '#ffffff'
    }
});
percentText.setOrigin(0.5, 0.5);

var assetText = this.make.text({
    x: width / 2,
    y: height / 2 + 50,
    text: '',
    style: {
        font: '18px monospace',
        fill: '#ffffff'
    }
});
assetText.setOrigin(0.5, 0.5);

this.load.on('fileprogress', function (file) {
    assetText.setText('Loading asset: ' + file.src);
});
    this.load.image('ground', 'assets/groundType4.png');
    this.load.image('star', 'assets/star.png');
    this.load.image('bomb', 'assets/alien.png');
    this.load.image('ufo', 'assets/ufo.png');
    this.load.spritesheet('dude', 'assets/astronaut.PNG',
        { frameWidth: 32, frameHeight: 45 }
    );
}

function create ()
{
  platforms = this.physics.add.staticGroup();

  platforms.create(400, 290, 'ufo')

  player = this.physics.add.sprite(100, 450, 'dude').setScale(2);

  player.setBounce(0.2);
  player.setCollideWorldBounds(true);



  this.anims.create({
      key: 'left',
      frames: this.anims.generateFrameNumbers('dude', { start: 3, end: 6 }),
      frameRate: 10,
      repeat: -1
  });

  this.anims.create({
      key: 'right',
      frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 2 }),
      frameRate: 7,
      repeat: -1
  });

  this.physics.add.collider(player, platforms);

  cursors = this.input.keyboard.createCursorKeys();

  scoreText = this.add.text(16, 16, 'Points: 0', { fontSize: '32px', fill: '#fff' });
}

var score = 0;
var scoreText;
var gameover = false


function update () {

    if(!gameover) {
      if (cursors.left.isDown) {
          player.setVelocityX(-160);

          player.anims.play('left', true);
      } else if (cursors.right.isDown) {
          player.setVelocityX(160);

          player.anims.play('right', true);
      } else {
          player.setVelocityX(0);

          player.anims.play('turn');
      }

      if (cursors.up.isDown && player.body.touching.down) {
          player.setVelocityY(-330);
      }
    }

    if (player.y > 550 ) {
      scoreText.setText("GAME OVER")
      gameover = true
      player.setVelocityX(0);
      player.setVelocityY(0);
      player.anims.play('dead');
      player.setTint(0xff0000);
    }
}

bombs = this.physics.add.group();

this.physics.add.collider(bombs, platforms);

this.physics.add.collider(player, bombs, hitBomb, null, this);

function hitBomb (player, bomb)
{
    this.physics.pause();

    player.setTint(0xff0000);

    player.anims.play('turn');

    gameOver = true;
}

function back() {
    window.location = './open-testlevels'
}

</script>
<button class="button button1-center" onclick="back()"> Back</button><br>
  </body>
</html>
